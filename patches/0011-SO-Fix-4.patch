From e74a98932478baee751a6bcdb0f58a5226a178d3 Mon Sep 17 00:00:00 2001
From: way-zer <himc.wicp@gmail.com>
Date: Sun, 18 Dec 2022 23:43:02 +0800
Subject: [PATCH] SO: Fix #4

---
 core/src/mindustry/ai/RtsAI.java | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/core/src/mindustry/ai/RtsAI.java b/core/src/mindustry/ai/RtsAI.java
index 6b37777..4f7f19c 100644
--- a/core/src/mindustry/ai/RtsAI.java
+++ b/core/src/mindustry/ai/RtsAI.java
@@ -23,6 +23,8 @@ import mindustry.world.blocks.storage.*;
 import mindustry.world.blocks.storage.CoreBlock.*;
 import mindustry.world.meta.*;
 
+import static mindustry.Vars.world;
+
 public class RtsAI{
     static final Seq<Building> targets = new Seq<>();
     static final Seq<Unit> squad = new Seq<>(false);
@@ -249,7 +251,7 @@ public class RtsAI{
         if(build != null || anyDefend){
             for(var unit : units){
                 if(unit.isCommandable() && !unit.command().hasCommand()){
-                    if(defendPos != null && !unit.isPathImpassable(World.toTile(defendPos.x), World.toTile(defendPos.y))){
+                    if(defendPos != null && world.tileWorld(defendPos.x, defendPos.y) != null && !unit.isPathImpassable(World.toTile(defendPos.x), World.toTile(defendPos.y))){
                         unit.command().commandPosition(defendPos, true);
                     }else{
                         //TODO stopAtTarget parameter could be false, could be tweaked
-- 
2.40.1.windows.1

